<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>HolidAI Chat Assistant</title>
	<link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
	<link rel="stylesheet" href="{{ url_for('static', filename='css/dashboard.css') }}">
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<style>
		/* Chat specific styles */
		.chat-container { max-width: 900px; margin: 40px auto; background: #ffffff; border-radius: 16px; box-shadow: 0 10px 30px rgba(0,0,0,0.08); overflow: hidden; }
		.chat-header { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: #fff; padding: 20px; }
		.chat-header h1 { font-size: 1.6rem; margin-bottom: 8px; }
		.chat-body { padding: 20px; height: 60vh; overflow-y: auto; background: #f7f9fc; }
		.message { display: flex; margin-bottom: 14px; }
		.message .bubble { padding: 12px 16px; border-radius: 12px; max-width: 75%; line-height: 1.4; white-space: pre-wrap; }
		.message.user { justify-content: flex-end; }
		.message.user .bubble { background: #667eea; color: white; border-bottom-right-radius: 4px; }
		.message.agent .bubble { background: #ffffff; border: 1px solid #e6eaf0; border-bottom-left-radius: 4px; }
		.chat-footer { padding: 16px; border-top: 1px solid #e6eaf0; display: flex; gap: 10px; }
		.chat-footer input { flex: 1; padding: 12px 16px; border: 2px solid #e1e5e9; border-radius: 10px; font-size: 16px; }
		.chat-footer button { padding: 12px 20px; background: #667eea; color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; }
		.chat-footer button:disabled { opacity: 0.6; cursor: not-allowed; }
		.system-note { color: #666; font-size: 0.9rem; margin: 8px 0 16px; }
		.small { font-size: 0.85rem; color: #777; }
		.typing { opacity: 0.7; font-style: italic; }
	</style>
</head>
<body class="dashboard">
	<!-- Navigation Header -->
	<header class="dashboard-header">
		<div class="container">
			<nav class="dashboard-nav">
				<div class="logo">
					<i class="fas fa-plane"></i> HolidAI
				</div>
				
				<div class="nav-menu">
					<a href="/" class="nav-link">
						<i class="fas fa-home"></i> Dashboard
					</a>
					<a href="/chat" class="nav-link active">
						<i class="fas fa-comments"></i> AI Assistant
					</a>
					<a href="#bookings" class="nav-link" onclick="showBookings()">
						<i class="fas fa-calendar-check"></i> My Bookings
					</a>
					<a href="#search" class="nav-link" onclick="showSearchModal()">
						<i class="fas fa-search"></i> Search Hotels
					</a>
				</div>
				
				<div class="user-menu">
					<div class="user-avatar" id="userAvatar">
						<i class="fas fa-user"></i>
					</div>
					<div class="user-info">
						<div class="user-name" id="userName">Welcome!</div>
						<div class="user-email" id="userEmail">Please log in</div>
					</div>
					<button class="btn btn-secondary btn-sm" onclick="logout()">
						<i class="fas fa-sign-out-alt"></i> Logout
					</button>
				</div>
			</nav>
		</div>
	</header>

	<div class="container">
			<div class="chat-container">
				<div class="chat-header">
					<h1><i class="fas fa-robot"></i> HolidAI Assistant</h1>
					<div class="small">Your intelligent travel planning companion. I can search hotels, help with bookings, and plan your perfect trip!</div>
				</div>
			<div id="chat" class="chat-body"></div>
			<div class="chat-footer">
				<input id="messageInput" type="text" placeholder="Tell me about your trip plans... e.g., 'I want to go to Paris for 4 nights'">
				<button id="sendBtn">Send</button>
			</div>
		</div>
	</div>

	<script>
		const chatEl = document.getElementById('chat');
		const inputEl = document.getElementById('messageInput');
		const sendBtn = document.getElementById('sendBtn');
		let sessionId = localStorage.getItem('hp_session_id') || `web_${Date.now()}`;
		localStorage.setItem('hp_session_id', sessionId);

		function appendMessage(role, text) {
			const div = document.createElement('div');
			div.className = `message ${role}`;
			const bubble = document.createElement('div');
			bubble.className = 'bubble';
			bubble.textContent = text;
			div.appendChild(bubble);
			chatEl.appendChild(div);
			chatEl.scrollTop = chatEl.scrollHeight;
		}

		function showTyping() {
			const div = document.createElement('div');
			div.className = 'message agent';
			div.id = 'typing';
			const bubble = document.createElement('div');
			bubble.className = 'bubble typing';
			bubble.textContent = 'ü§î Thinking and using tools...';
			div.appendChild(bubble);
			chatEl.appendChild(div);
			chatEl.scrollTop = chatEl.scrollHeight;
		}

		function hideTyping() {
			const typing = document.getElementById('typing');
			if (typing) typing.remove();
		}

		// Welcome message
		appendMessage('agent', 'Hi! I\'m your AI travel assistant powered by Claude. I can help you plan your trip by:\n\n‚Ä¢ Searching real hotels using SerpApi\n‚Ä¢ Filtering by rating, price, amenities\n‚Ä¢ Calculating budgets and expenses\n‚Ä¢ Finding nearby attractions\n\nTell me about your travel plans!');

		sendBtn.addEventListener('click', sendMessage);
		inputEl.addEventListener('keydown', (e) => { if (e.key === 'Enter') sendMessage(); });

		async function sendMessage() {
			const text = inputEl.value.trim();
			if (!text) return;
			
			appendMessage('user', text);
			inputEl.value = '';
			sendBtn.disabled = true;
			showTyping();
			
			try {
				const res = await fetch('/api/chat', {
					method: 'POST',
					headers: { 'Content-Type': 'application/json' },
					body: JSON.stringify({ session_id: sessionId, message: text })
				});
				const data = await res.json();
				
				hideTyping();
				
				if (!data.success) {
					appendMessage('agent', `‚ùå Error: ${data.error}`);
					return;
				}
				
				appendMessage('agent', data.response);
			} catch (e) {
				hideTyping();
				appendMessage('agent', '‚ùå Network error: ' + e.message);
			} finally {
				sendBtn.disabled = false;
				inputEl.focus();
			}
		}
	</script>
	<script src="{{ url_for('static', filename='js/dashboard.js') }}"></script>
</body>
</html>
